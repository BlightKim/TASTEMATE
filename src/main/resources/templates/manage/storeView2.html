<!DOCTYPE html>
<html lagn="ko"
      xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="header_footer/header :: headerFragment"></th:block>


<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/store_css.css}">


  <!-- alert 꾸미기 -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


  <style>
    body {
      min-height: 100vh;

      background: -webkit-gradient(linear, left bottom, right top, from(#E9DFED), to(#E9DFED));
      background: -webkit-linear-gradient(bottom left, #E9DFED 0%, #E9DFED 100%);
      background: -moz-linear-gradient(bottom left, #E9DFED 0%, #E9DFED 100%);
      background: -o-linear-gradient(bottom left, #E9DFED 0%, #E9DFED 100%);
      background: linear-gradient(to top right, #E9DFED 0%, #E9DFED 100%);
    }

    .input-form {
      /*max-width: 680px;*/

      margin-top: 80px;
      margin-bottom: 80px;
      padding: 32px;

      background: #fff;
      -webkit-border-radius: 10px;
      -moz-border-radius: 10px;
      border-radius: 10px;
      -webkit-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);
      -moz-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);
      box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15)
    }

    /* 별점 구현 */
    #star{
      display: inline-block;
      direction: rtl;
      border:0;
    }
    #star legend{
      text-align: right;
    }
    input[type=radio]{
      display: none;
    }
    #star label{
      font-size: 2em;
      color: transparent;
      text-shadow: 0 0 0 #f0f0f0;
    }
    #star label:hover{
      text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
    }
    #star label:hover ~ label{
      text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
    }
    #star input[type=radio]:checked ~ label{
      text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
    }
    .disable {
      background-color: darkgray;
    }

  </style>
</head>
<body>


<div class="container">
  <div class="input-form-backgroud row">
    <div class="input-form col-md-12 mx-auto">
      <h3 class="mb-3 mb-5 purple2 text-center">추천 맛집 상세정보</h3>

        <div class="row">
          <div class="col-md-8 mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-egg-fried" viewBox="0 0 16 16">
              <path d="M8 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
              <path d="M13.997 5.17a5 5 0 0 0-8.101-4.09A5 5 0 0 0 1.28 9.342a5 5 0 0 0 8.336 5.109 3.5 3.5 0 0 0 5.201-4.065 3.001 3.001 0 0 0-.822-5.216zm-1-.034a1 1 0 0 0 .668.977 2.001 2.001 0 0 1 .547 3.478 1 1 0 0 0-.341 1.113 2.5 2.5 0 0 1-3.715 2.905 1 1 0 0 0-1.262.152 4 4 0 0 1-6.67-4.087 1 1 0 0 0-.2-1 4 4 0 0 1 3.693-6.61 1 1 0 0 0 .8-.2 4 4 0 0 1 6.48 3.273z"/>
            </svg>
            <label for="storeName">맛집 이름</label>
            <input type="text" class="form-control" id="storeName" name="storeName" readonly th:value="${storeView.storeName}">
          </div>


          <!--
                     userIdx 세션에서 넣어줘. 등록한 사람만 수정, 삭제할 수 있게 insert 해야함
          -->

          <div class="col-md-4 mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
              <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
            </svg>
            <label for="userId">사용자 ID</label>
            <input type="text" class="form-control" id="userId" name="userId" readonly th:value="${storeView.userId}">
            <input type="hidden" class="form-control" id="userName" name="userName" th:value="${storeView.userName}">
          </div>
        </div>

        <div class = "row">
          <div class="col-md-8 mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-bookmark-heart" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z"/>
              <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
            </svg>
            <label for="category1">카테고리</label>
            <div class="mb-3">
              <div class="form-group">
                <select class="form-control" id="category1" name="category1" required>
                  <option th:value="${storeView.category1 }" selected readonly>[[${storeView.category1 }]]</option>
                </select>
              </div>
            </div>
          </div>
        </div>


        <!-- 카카오 주소 api -->
        <div class="mb-3">
          <label>맛집 주소</label>
          <input type="text" name="zipcode" id="zipcode" size="7"
                 class="form-control" readonly>

          <input type="text" name="storeAddress" id="address"
                 size="70" class="form-control" readonly th:value="${storeView.storeAddress}">

        </div>

        <!-- 카카오 주소 api 끝 -->



        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="storeLati">위도</label>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-patch-question-fill" viewBox="0 0 16 16">
                <path d="M5.933.87a2.89 2.89 0 0 1 4.134 0l.622.638.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636zM7.002 11a1 1 0 1 0 2 0 1 1 0 0 0-2 0zm1.602-2.027c.04-.534.198-.815.846-1.26.674-.475 1.05-1.09 1.05-1.986 0-1.325-.92-2.227-2.262-2.227-1.02 0-1.792.492-2.1 1.29A1.71 1.71 0 0 0 6 5.48c0 .393.203.64.545.64.272 0 .455-.147.564-.51.158-.592.525-.915 1.074-.915.61 0 1.03.446 1.03 1.084 0 .563-.208.885-.822 1.325-.619.433-.926.914-.926 1.64v.111c0 .428.208.745.585.745.336 0 .504-.24.554-.627z"/>
              </svg>
            </a>
            <input type="text" class="form-control" id="storeLati" name="storeLati" readonly th:value="${storeView.storeLati}" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="storeLongi">경도</label>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-patch-question-fill" viewBox="0 0 16 16">
                <path d="M5.933.87a2.89 2.89 0 0 1 4.134 0l.622.638.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636zM7.002 11a1 1 0 1 0 2 0 1 1 0 0 0-2 0zm1.602-2.027c.04-.534.198-.815.846-1.26.674-.475 1.05-1.09 1.05-1.986 0-1.325-.92-2.227-2.262-2.227-1.02 0-1.792.492-2.1 1.29A1.71 1.71 0 0 0 6 5.48c0 .393.203.64.545.64.272 0 .455-.147.564-.51.158-.592.525-.915 1.074-.915.61 0 1.03.446 1.03 1.084 0 .563-.208.885-.822 1.325-.619.433-.926.914-.926 1.64v.111c0 .428.208.745.585.745.336 0 .504-.24.554-.627z"/>
              </svg>
            </a>
            <input type="text" class="form-control" id="storeLongi" name="storeLongi" readonly th:value="${storeView.storeLongi}" required>
          </div>
        </div>
        <div class="mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
            <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
          </svg>
          <label for="phoneNumber">맛집 전화번호</label>
          <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" readonly th:value="${storeView.phoneNumber}" required>
        </div>

        <div class="mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-card-image" viewBox="0 0 16 16">
            <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
            <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54A.505.505 0 0 1 1 12.5v-9a.5.5 0 0 1 .5-.5h13z"/>
          </svg>
          <label>이미지</label><br>
            <img th:src="@{|/store/${storeView.filename}|}" width="300px"/>
        </div>



        <div class="text-center mt-5 mb-3">
          <form method="post">
            <input type="hidden" name="storeIdx" th:value="${storeView.storeIdx}">
            <button onclick="storeUpdateView(this.form)" class="btn text-white" style="background-color: #8E48C7">수정</button>
<!--            <button onclick="deleteManageStore(this.form)" class="btn text-white" style="background-color: #601599">삭제</button>-->
            <button onclick="openDeleteModal()" id="deleteForm" class="btn text-white" style="background-color: #601599">삭제</button>
            <a th:href="@{/manage/storeList}" class="btn text-white" style="background-color: #9C91B3">목록</a>
          </form>
        </div>





        <!-- 리뷰 수정 삭제 기능 (임시) -->
        <hr>
        <div th:each="manageStarVO : ${manageStarVOList}">
          <p>유저(인덱스): [[${manageStarVO.userIdx}]]/ 별점: [[${manageStarVO.storeStar}]]/ 리뷰: [[${manageStarVO.storeComment}]]</p>
          <!-- if문 필요: userType(세션값) == 0(관리자) 또는 userIdx(세션값) == manageStarVO.userIdx 일때만 보인다. -->
          <form method="post">
            <div>
              <input type="hidden" name="starIdx" th:value="${manageStarVO.starIdx}">
              <input type="hidden" name="storeStar" th:value="${manageStarVO.storeStar}">
              <input type="hidden" name="storeComment" th:value="${manageStarVO.storeComment}">
              <input type="hidden" name="storeIdx" th:value="${storeView.storeIdx}">
            </div>
            <div>
              <button onclick="updateStoreReview(this.form)" class="btn text-white btn-sm" style="background-color: #E9DFED">수정</button>
              <button onclick="deleteStoreReview(this.form)" class="btn text-white btn-sm" style="background-color: #8E48C7">삭제</button>
            </div>
          </form>
          </div>
        </div>



    </div>
  </div>
</div>

<!-- 카카오 주소 api -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
  function kakaopost() {
    new daum.Postcode({
      oncomplete: function(data) {
        document.querySelector("#zipcode").value = data.zonecode;
        document.querySelector("#address").value = data.address
      }
    }).open();
  }
</script>
<!--끝-->



<!-- Alert, Confirm Modal -->
<div class="modal" id="msg_popup" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <!-- MSG Space-->
      </div>
      <div class="modal-footer" id="btn_confirm">
        <button type="button" id="confirm_yes" class="btn btn-primary" data-dismiss="modal" >YES</button>
        <button type="button" id="confirm_no"class="btn btn-secondary" data-dismiss="modal">NO</button>
      </div>
      <div class="modal-footer" id="btn_alert">
        <button type="button" id="alert_ok"class="btn btn-primary" data-dismiss="modal" >OK</button>
      </div>
    </div>
  </div>
</div>

<!-- 삭제 모달 -->
<div class="modal" id="deleteModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- 모달 헤더 -->
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">리뷰 삭제</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!-- 모달 본문 -->
      <div class="modal-body">
        리뷰를 삭제하시겠습니까?
      </div>
      <!-- 모달 푸터 -->
      <div class="modal-footer">
        <!-- 취소 버튼 -->
        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
        <!-- 삭제 버튼 -->
        <button type="button" class="btn btn-danger" onclick="deleteReview()">삭제</button>
      </div>
    </div>
  </div>
</div>

<script>
  // 삭제 모달을 열기 위한 함수
  function openDeleteModal() {
    // 모달을 보여줌
    $('#deleteModal').modal({
      backdrop: 'static', // 모달 외부를 클릭해도 모달이 사라지지 않도록 함
      keyboard: false // 키보드의 ESC 키를 사용해도 모달이 사라지지 않도록 함
    });
  }

  // 리뷰 삭제를 처리하는 함수
  function deleteReview() {
    // 확인 대화상자를 통해 사용자에게 삭제 여부를 확인
    let isDelete = confirm("리뷰를 삭제하시겠습니까?");
    if (isDelete) {
      // 삭제 버튼을 클릭하고 확인을 선택한 경우, 폼을 제출
      let frm = document.getElementById('deleteForm');
      frm.action = '/manage/deleteUserReview';
      frm.submit();
    }
  }
</script>

<script>
  /* 맛집 수정*/
  function storeUpdateView(frm) {
    frm.action='/manage/storeUpdateView';
    frm.submit();
  }

// <!--    /* 맛집 삭제 */-->
//
// <!--    function deleteManageStore(frm){-->
// <!--        let isDelete = confirm("삭제하시겠습니까?");-->
// <!--        if (isDelete) {-->
<!--          frm.action='/manage/deleteManageStore';-->
<!--          frm.submit();-->
// <!--        } else {-->
// <!--          history.back();-->
// <!--        };-->
// <!--    }-->
</script>



<script>
    /* 리뷰 수정 */
    function updateStoreReview(frm) {
      frm.action="/manage/viewUserReview";
      frm.submit();
    }

    /* 리뷰 삭제 */
  function deleteStoreReview(frm) {
    let isDelete = confirm("리뷰를 삭제하시겠습니까?");
    if (isDelete) {
      frm.action='/manage/deleteUserReview';
      frm.submit();
    } else {
      history.back();
    };
  }
</script>

<th:block th:replace="header_footer/footer :: footerFragment"></th:block>
</body>
</html>